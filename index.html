<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submarine Cable Tracker - Explore the Internet's Underwater Highways</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 380px;
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            padding: 25px;
            box-shadow: 2px 0 15px rgba(0,0,0,0.4);
            overflow-y: auto;
            border-right: 1px solid #333;
        }
        
        .title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        .subtitle {
            font-size: 14px;
            color: #888;
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.4;
        }
        
        .section {
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #00d4ff;
            display: flex;
            align-items: center;
        }

        .section-title::before {
            content: "üåç";
            margin-right: 8px;
        }

        .section.advanced .section-title::before {
            content: "‚öôÔ∏è";
        }

        .section.stats .section-title::before {
            content: "üìä";
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #cccccc;
            font-weight: 500;
        }
        
        select, input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #333;
            border-radius: 10px;
            background: #2a2a3e;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        select:focus, input[type="text"]:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            background: #323248;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            background: linear-gradient(45deg, #0099cc, #006699);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 212, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #4a4a6a, #353550);
            font-size: 13px;
            padding: 10px;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(45deg, #353550, #2a2a3e);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        #map {
            flex: 1;
            position: relative;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            flex-direction: column;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #333;
            border-top: 4px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #00d4ff;
            font-size: 18px;
            font-weight: 600;
        }
        
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 20px;
            max-width: 350px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .cable-info {
            margin-bottom: 15px;
        }
        
        .cable-name {
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .cable-details {
            font-size: 13px;
            color: #cccccc;
            line-height: 1.5;
        }

        .cable-details strong {
            color: #ffffff;
        }
        
        .status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 8px;
            text-transform: uppercase;
        }
        
        .status.active {
            background: #28a745;
            color: white;
        }
        
        .status.planned {
            background: #ffc107;
            color: #000;
        }

        .close-panel {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #888;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-panel:hover {
            color: #ffffff;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .legend-circle {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .trace-result {
            background: #2a2a3e;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-height: 180px;
            overflow-y: auto;
            border: 1px solid #444;
        }

        .trace-result .submarine-line {
            color: #00d4ff;
            font-weight: bold;
        }
        
        .loading {
            color: #00d4ff;
            text-align: center;
            padding: 15px;
            animation: pulse 1.5s infinite;
        }
        
        .error-message {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 13px;
            border-left: 4px solid #fff;
        }

        .success-message {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 13px;
            border-left: 4px solid #fff;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .advanced-toggle {
            text-align: center;
            margin: 20px 0;
        }

        .toggle-btn {
            background: none;
            border: 1px solid #444;
            color: #888;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            border-color: #00d4ff;
            color: #00d4ff;
        }

        .advanced-section {
            display: none;
        }

        .advanced-section.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .stat-number {
            font-size: 20px;
            font-weight: bold;
            color: #00d4ff;
            display: block;
        }

        .stat-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 5px;
            line-height: 1.3;
        }

        .route-results {
            background: rgba(0, 212, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }

        .route-cable {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .route-cable:last-child {
            border-bottom: none;
        }

        .cable-name-small {
            color: #00d4ff;
            font-weight: 500;
            font-size: 13px;
        }

        .cable-probability {
            color: #28a745;
            font-size: 12px;
            font-weight: 600;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 40vh;
                order: 2;
            }
            
            #map {
                height: 60vh;
                order: 1;
            }

            .info-panel {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .legend {
                bottom: 10px;
                left: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading Submarine Cable Data...</div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="title">üåä Submarine Cable Tracker</div>
            <div class="subtitle">Discover how your internet data travels across the ocean floor through underwater cables connecting continents.</div>
            
            <div class="section">
                <div class="section-title">Explore Cable Routes</div>
                <div class="input-group">
                    <label for="fromCountry">From Country:</label>
                    <select id="fromCountry">
                        <option value="">Select your country...</option>
                        <option value="US">üá∫üá∏ United States</option>
                        <option value="CA">üá®üá¶ Canada</option>
                        <option value="MX">üá≤üáΩ Mexico</option>
                        <option value="BR">üáßüá∑ Brazil</option>
                        <option value="AR">üá¶üá∑ Argentina</option>
                        <option value="CL">üá®üá± Chile</option>
                        <option value="CO">üá®üá¥ Colombia</option>
                        <option value="PE">üáµüá™ Peru</option>
                        <option value="VE">üáªüá™ Venezuela</option>
                        <option value="UK">üá¨üáß United Kingdom</option>
                        <option value="IE">üáÆüá™ Ireland</option>
                        <option value="FR">üá´üá∑ France</option>
                        <option value="ES">üá™üá∏ Spain</option>
                        <option value="PT">üáµüáπ Portugal</option>
                        <option value="IT">üáÆüáπ Italy</option>
                        <option value="DE">üá©üá™ Germany</option>
                        <option value="NL">üá≥üá± Netherlands</option>
                        <option value="BE">üáßüá™ Belgium</option>
                        <option value="SE">üá∏üá™ Sweden</option>
                        <option value="NO">üá≥üá¥ Norway</option>
                        <option value="DK">üá©üá∞ Denmark</option>
                        <option value="FI">üá´üáÆ Finland</option>
                        <option value="PL">üáµüá± Poland</option>
                        <option value="RU">üá∑üá∫ Russia</option>
                        <option value="JP">üáØüáµ Japan</option>
                        <option value="KR">üá∞üá∑ South Korea</option>
                        <option value="CN">üá®üá≥ China</option>
                        <option value="IN">üáÆüá≥ India</option>
                        <option value="PK">üáµüá∞ Pakistan</option>
                        <option value="BD">üáßüá© Bangladesh</option>
                        <option value="TH">üáπüá≠ Thailand</option>
                        <option value="VN">üáªüá≥ Vietnam</option>
                        <option value="MY">üá≤üáæ Malaysia</option>
                        <option value="SG">üá∏üá¨ Singapore</option>
                        <option value="ID">üáÆüá© Indonesia</option>
                        <option value="PH">üáµüá≠ Philippines</option>
                        <option value="AU">üá¶üá∫ Australia</option>
                        <option value="NZ">üá≥üáø New Zealand</option>
                        <option value="ZA">üáøüá¶ South Africa</option>
                        <option value="EG">üá™üá¨ Egypt</option>
                        <option value="MA">üá≤üá¶ Morocco</option>
                        <option value="NG">üá≥üá¨ Nigeria</option>
                        <option value="KE">üá∞üá™ Kenya</option>
                        <option value="GH">üá¨üá≠ Ghana</option>
                        <option value="AE">üá¶üá™ UAE</option>
                        <option value="SA">üá∏üá¶ Saudi Arabia</option>
                        <option value="IL">üáÆüá± Israel</option>
                        <option value="TR">üáπüá∑ Turkey</option>
                        <option value="GR">üá¨üá∑ Greece</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="toCountry">To Country:</label>
                    <select id="toCountry">
                        <option value="">Select destination country...</option>
                        <option value="US">üá∫üá∏ United States</option>
                        <option value="CA">üá®üá¶ Canada</option>
                        <option value="MX">üá≤üáΩ Mexico</option>
                        <option value="BR">üáßüá∑ Brazil</option>
                        <option value="AR">üá¶üá∑ Argentina</option>
                        <option value="CL">üá®üá± Chile</option>
                        <option value="CO">üá®üá¥ Colombia</option>
                        <option value="PE">üáµüá™ Peru</option>
                        <option value="VE">üáªüá™ Venezuela</option>
                        <option value="UK">üá¨üáß United Kingdom</option>
                        <option value="IE">üáÆüá™ Ireland</option>
                        <option value="FR">üá´üá∑ France</option>
                        <option value="ES">üá™üá∏ Spain</option>
                        <option value="PT">üáµüáπ Portugal</option>
                        <option value="IT">üáÆüáπ Italy</option>
                        <option value="DE">üá©üá™ Germany</option>
                        <option value="NL">üá≥üá± Netherlands</option>
                        <option value="BE">üáßüá™ Belgium</option>
                        <option value="SE">üá∏üá™ Sweden</option>
                        <option value="NO">üá≥üá¥ Norway</option>
                        <option value="DK">üá©üá∞ Denmark</option>
                        <option value="FI">üá´üáÆ Finland</option>
                        <option value="PL">üáµüá± Poland</option>
                        <option value="RU">üá∑üá∫ Russia</option>
                        <option value="JP">üáØüáµ Japan</option>
                        <option value="KR">üá∞üá∑ South Korea</option>
                        <option value="CN">üá®üá≥ China</option>
                        <option value="IN">üáÆüá≥ India</option>
                        <option value="PK">üáµüá∞ Pakistan</option>
                        <option value="BD">üáßüá© Bangladesh</option>
                        <option value="TH">üáπüá≠ Thailand</option>
                        <option value="VN">üáªüá≥ Vietnam</option>
                        <option value="MY">üá≤üáæ Malaysia</option>
                        <option value="SG">üá∏üá¨ Singapore</option>
                        <option value="ID">üáÆüá© Indonesia</option>
                        <option value="PH">üáµüá≠ Philippines</option>
                        <option value="AU">üá¶üá∫ Australia</option>
                        <option value="NZ">üá≥üáø New Zealand</option>
                        <option value="ZA">üáøüá¶ South Africa</option>
                        <option value="EG">üá™üá¨ Egypt</option>
                        <option value="MA">üá≤üá¶ Morocco</option>
                        <option value="NG">üá≥üá¨ Nigeria</option>
                        <option value="KE">üá∞üá™ Kenya</option>
                        <option value="GH">üá¨üá≠ Ghana</option>
                        <option value="AE">üá¶üá™ UAE</option>
                        <option value="SA">üá∏üá¶ Saudi Arabia</option>
                        <option value="IL">üáÆüá± Israel</option>
                        <option value="TR">üáπüá∑ Turkey</option>
                        <option value="GR">üá¨üá∑ Greece</option>
                    </select>
                </div>
                
                <button class="btn" onclick="findCablesBetweenCountries()">üîç Find Possible Cables</button>
                <div class="help-text">Select two countries to see what underwater cables might connect them and carry internet traffic between these locations.</div>
                
                <div id="routeResults"></div>
            </div>

            <div class="section">
                <div class="section-title">Map Controls</div>
                <div class="controls-grid">
                    <button class="btn btn-secondary btn-small" onclick="showAllCables()">Show All Cables</button>
                    <button class="btn btn-secondary btn-small" onclick="toggleLandingPoints()">Toggle Stations</button>
                    <button class="btn btn-secondary btn-small" onclick="clearHighlights()">Clear Selection</button>
                    <button class="btn btn-secondary btn-small" onclick="resetView()">Reset View</button>
                </div>
                <div class="help-text">Use these controls to customize what you see on the map. Landing stations are where cables come ashore.</div>
            </div>

            <div class="advanced-toggle">
                <button class="toggle-btn" onclick="toggleAdvanced()">‚öôÔ∏è Show Advanced Features</button>
            </div>

            <div class="advanced-section" id="advancedSection">
                <div class="section advanced">
                    <div class="section-title">Network Trace</div>
                    <div class="input-group">
                        <label for="targetHost">Target Website or IP:</label>
                        <input type="text" id="targetHost" placeholder="e.g., google.com, facebook.com, 8.8.8.8">
                    </div>
                    <button class="btn btn-secondary" onclick="simulateTraceroute()">üîç Trace Network Path</button>
                    <div class="help-text">This shows a simulated path your internet data might take to reach a specific website, including which submarine cables it could use.</div>
                    <div id="traceResult"></div>
                </div>
            </div>
            
            <div class="section stats">
                <div class="section-title">Cable Statistics</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="totalCables">...</span>
                        <span class="stat-label">Total Cables</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="activeCables">...</span>
                        <span class="stat-label">Active Cables</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalLandingPoints">...</span>
                        <span class="stat-label">Landing Stations</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalLength">...</span>
                        <span class="stat-label">Total Length (km)</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="map"></div>
        
        <div class="info-panel" id="infoPanel">
            <button class="close-panel" onclick="closeCableInfo()">√ó</button>
            <div id="panelContent"></div>
        </div>
        
        <div class="legend">
            <div style="font-weight: bold; margin-bottom: 12px; color: #00d4ff;">Map Legend</div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00d4ff;"></div>
                <span>Submarine Cables</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #ff6b6b;"></div>
                <span>Cable Landing Stations</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffd93d;"></div>
                <span>Highlighted Routes</span>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const MAPBOX_TOKEN = 'pk.eyJ1IjoiaWFubXVzYSIsImEiOiJjbWJ4aWM2cDExZDExMmpxM3RlOW9oeHY1In0.49j5NWnRfBOLdx_yhKO1YQ';
        
        // Global variables
        let map = null;
        let cablesData = null;
        let landingPointsData = null;
        let landingPointsVisible = false;
        let mapInitialized = false;
        
        // Country to region mapping for cable analysis
        const countryRegions = {
            'US': 'North America', 'CA': 'North America', 'MX': 'North America',
            'BR': 'South America', 'AR': 'South America', 'CL': 'South America', 'CO': 'South America', 'PE': 'South America', 'VE': 'South America',
            'UK': 'Europe', 'IE': 'Europe', 'FR': 'Europe', 'ES': 'Europe', 'PT': 'Europe', 'IT': 'Europe', 'DE': 'Europe', 'NL': 'Europe', 'BE': 'Europe',
            'SE': 'Europe', 'NO': 'Europe', 'DK': 'Europe', 'FI': 'Europe', 'PL': 'Europe', 'GR': 'Europe', 'TR': 'Europe',
            'RU': 'Europe/Asia',
            'JP': 'Asia', 'KR': 'Asia', 'CN': 'Asia', 'IN': 'Asia', 'PK': 'Asia', 'BD': 'Asia', 'TH': 'Asia', 'VN': 'Asia',
            'MY': 'Asia', 'SG': 'Asia', 'ID': 'Asia', 'PH': 'Asia',
            'AU': 'Oceania', 'NZ': 'Oceania',
            'ZA': 'Africa', 'EG': 'Africa', 'MA': 'Africa', 'NG': 'Africa', 'KE': 'Africa', 'GH': 'Africa',
            'AE': 'Middle East', 'SA': 'Middle East', 'IL': 'Middle East'
        };

        // Real cable data mapping (expanded)
        const realCableRoutes = {
            'US-UK': ['TAT-14 (Trans-Atlantic)', 'Hibernia Atlantic', 'Apollo North', 'Marea'],
            'US-JP': ['PC-1 (Pacific Crossing)', 'TPC-5CN', 'FASTER', 'Pluto'],
            'US-BR': ['Americas-II', 'BRUSA', 'Seabras-1', 'Monet'],
            'UK-FR': ['CrossChannel', 'UK-France 3'],
            'UK-DE': ['C-Lion1', 'TAT-14 Extension'],
            'UK-NO': ['NorNed', 'North Sea Connect'],
            'FR-ES': ['Pencan-5'],
            'JP-SG': ['Asia Submarine-cable Express (ASE)', 'SJC (Southeast Asia-Japan Cable)'],
            'SG-AU': ['SEA-ME-WE 3', 'Indigo-West', 'ASC (Australia-Singapore Cable)'],
            'IN-SG': ['SEA-ME-WE 4', 'i2i Cable'],
            'AU-NZ': ['Southern Cross Cable', 'Tasman-2'],
            'CN-JP': ['Asia Pacific Gateway (APG)', 'EAST (Europe-Asia)'],
            'EG-IT': ['SEA-ME-WE 4', 'Imewe'],
            'ZA-UK': ['SAT-3/WASC', 'WACS (West Africa Cable System)'],
            'BR-US': ['Americas-II', 'Seabras-1'],
            'CA-UK': ['Hibernia Atlantic', 'TAT-14']
        };

        // Initialize the application
        function init() {
            mapboxgl.accessToken = MAPBOX_TOKEN;
            initMap();
        }
        
        // Initialize the map
        function initMap() {
            try {
                map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/dark-v11',
                    center: [0, 20],
                    zoom: 2.2,
                    projection: 'naturalEarth'
                });
                
                map.on('load', function() {
                    mapInitialized = true;
                    loadSubmarineCables();
                    loadLandingPoints();
                });
                
                // Add navigation controls
                map.addControl(new mapboxgl.NavigationControl(), 'top-right');
                
                // Add scale control
                map.addControl(new mapboxgl.ScaleControl(), 'bottom-left');
                
                // Click handlers for cables
                map.on('click', 'cables', handleCableClick);
                map.on('mouseenter', 'cables', () => map.getCanvas().style.cursor = 'pointer');
                map.on('mouseleave', 'cables', () => map.getCanvas().style.cursor = '');
                
                // Click handlers for landing points
                map.on('click', 'landing-points', handleLandingPointClick);
                map.on('mouseenter', 'landing-points', () => map.getCanvas().style.cursor = 'pointer');
                map.on('mouseleave', 'landing-points', () => map.getCanvas().style.cursor = '');
                
            } catch (error) {
                console.error('Error initializing map:', error);
                hideLoading();
                showError('Failed to initialize map. Please check your internet connection.');
            }
        }
        
        // Load submarine cables data
        async function loadSubmarineCables() {
            try {
                showMessage('Loading submarine cables...', 'info');
                
                const response = await fetch('https://www.submarinecablemap.com/api/v3/cable/cable-geo.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                cablesData = data;
                
                // Add cables to map
                map.addSource('cables', {
                    'type': 'geojson',
                    'data': data
                });
                
                map.addLayer({
                    'id': 'cables',
                    'type': 'line',
                    'source': 'cables',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': [
                            'case',
                            ['has', 'highlight'],
                            '#ffd93d',
                            '#00d4ff'
                        ],
                        'line-width': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            1, 1,
                            3, 2,
                            6, 3,
                            10, 4
                        ],
                        'line-opacity': 0.8
                    }
                });
                
                // Update statistics
                updateStatistics(data);
                
                console.log(`‚úÖ Loaded ${data.features.length} submarine cables`);
                showMessage(`‚úÖ Loaded ${data.features.length} submarine cables`, 'success');
                
            } catch (error) {
                console.error('Error loading submarine cables:', error);
                showError('Unable to load real cable data. Using sample data for demonstration.');
                createSampleCableData();
            }
        }
        
        // Create sample cable data if real data fails to load
        function createSampleCableData() {
            const sampleCables = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "Sample Transatlantic Cable",
                            "id": "sample-transatlantic",
                            "rfs": "2024",
                            "owners": "Sample Telecom",
                            "length": 6500
                        },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [[-74, 40.7], [-0.1, 51.5]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "Sample Transpacific Cable",
                            "id": "sample-transpacific",
                            "rfs": "2023",
                            "owners": "Sample Networks",
                            "length": 12000
                        },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [[-122.4, 37.8], [139.7, 35.7]]
                        }
                    }
                ]
            };
            
            cablesData = sampleCables;
            
            map.addSource('cables', {
                'type': 'geojson',
                'data': sampleCables
            });
            
            map.addLayer({
                'id': 'cables',
                'type': 'line',
                'source': 'cables',
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#00d4ff',
                    'line-width': 2,
                    'line-opacity': 0.8
                }
            });
            
            // Update statistics with sample data
            document.getElementById('totalCables').textContent = '2 (Sample)';
            document.getElementById('activeCables').textContent = '2 (Sample)';
            document.getElementById('totalLength').textContent = '18.5k';
        }
        
        // Load landing points data
        async function loadLandingPoints() {
            try {
                const response = await fetch('https://www.submarinecablemap.com/api/v3/landing-point/landing-point-geo.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                landingPointsData = data;
                
                map.addSource('landing-points', {
                    'type': 'geojson',
                    'data': data
                });
                
                map.addLayer({
                    'id': 'landing-points',
                    'type': 'circle',
                    'source': 'landing-points',
                    'layout': {
                        'visibility': 'none'
                    },
                    'paint': {
                        'circle-radius': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            1, 2,
                            3, 3,
                            6, 4,
                            10, 6
                        ],
                        'circle-color': '#ff6b6b',
                        'circle-opacity': 0.8,
                        'circle-stroke-color': '#ffffff',
                        'circle-stroke-width': 1
                    }
                });
                
                // Update statistics
                document.getElementById('totalLandingPoints').textContent = data.features.length;
                console.log(`‚úÖ Loaded ${data.features.length} landing points`);
                
            } catch (error) {
                console.error('Error loading landing points:', error);
                document.getElementById('totalLandingPoints').textContent = 'Error loading';
            } finally {
                hideLoading();
            }
        }

        // Update statistics
        function updateStatistics(data) {
            const totalCables = data.features.length;
            const activeCables = data.features.filter(f => f.properties.rfs && parseInt(f.properties.rfs) <= new Date().getFullYear()).length;
            
            // Calculate total length
            let totalLength = 0;
            data.features.forEach(cable => {
                if (cable.properties.length) {
                    totalLength += parseInt(cable.properties.length) || 0;
                }
            });
            
            document.getElementById('totalCables').textContent = totalCables.toLocaleString();
            document.getElementById('activeCables').textContent = activeCables.toLocaleString();
            document.getElementById('totalLength').textContent = totalLength > 1000000 ? 
                `${(totalLength / 1000000).toFixed(1)}M` : 
                `${(totalLength / 1000).toFixed(0)}K`;
        }
        
        // Handle cable click
        function handleCableClick(e) {
            const cableInfo = e.features[0].properties;
            showCableInfo(cableInfo);
        }

        // Handle landing point click
        function handleLandingPointClick(e) {
            const pointInfo = e.features[0].properties;
            showLandingPointInfo(pointInfo);
        }
        
        // Show cable information
        function showCableInfo(cableInfo) {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');
            
            const readyForService = cableInfo.rfs ? new Date(cableInfo.rfs).getFullYear() : 'Unknown';
            const length = cableInfo.length ? `${parseInt(cableInfo.length).toLocaleString()} km` : 'Unknown';
            const owners = cableInfo.owners || 'Not specified';
            
            content.innerHTML = `
                <div class="cable-info">
                    <div class="cable-name">${cableInfo.name || 'Unknown Cable'}</div>
                    <div class="cable-details">
                        <strong>Ready for Service:</strong> ${readyForService}<br>
                        <strong>Length:</strong> ${length}<br>
                        <strong>Owners:</strong> ${owners}<br>
                        <strong>Cable ID:</strong> ${cableInfo.id || 'N/A'}
                    </div>
                    <div class="status active">Active Cable</div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <div style="font-size: 12px; color: #888; line-height: 1.4;">
                        This submarine cable carries internet data across the ocean floor. Click on other cables to explore more routes.
                    </div>
                </div>
            `;
            
            panel.style.display = 'block';
        }

        // Show landing point information
        function showLandingPointInfo(pointInfo) {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');
            
            content.innerHTML = `
                <div class="cable-info">
                    <div class="cable-name">üè¢ ${pointInfo.name || 'Landing Station'}</div>
                    <div class="cable-details">
                        <strong>Location:</strong> ${pointInfo.country || 'Unknown'}<br>
                        <strong>City:</strong> ${pointInfo.city || 'Not specified'}<br>
                        <strong>Station ID:</strong> ${pointInfo.id || 'N/A'}
                    </div>
                    <div class="status active">Landing Station</div>
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2);">
                    <div style="font-size: 12px; color: #888; line-height: 1.4;">
                        Landing stations are facilities where submarine cables come ashore and connect to the terrestrial internet infrastructure.
                    </div>
                </div>
            `;
            
            panel.style.display = 'block';
        }

        // Close cable info panel
        function closeCableInfo() {
            document.getElementById('infoPanel').style.display = 'none';
        }
        
        // Find cables between countries
        function findCablesBetweenCountries() {
            const fromCountry = document.getElementById('fromCountry').value;
            const toCountry = document.getElementById('toCountry').value;
            
            if (!fromCountry || !toCountry) {
                showError('Please select both countries to find possible cable routes.');
                return;
            }
            
            if (!mapInitialized) {
                showError('Please wait for the map to finish loading.');
                return;
            }

            if (fromCountry === toCountry) {
                showError('Please select two different countries.');
                return;
            }
            
            // Look for real cable routes
            const routeKey1 = `${fromCountry}-${toCountry}`;
            const routeKey2 = `${toCountry}-${fromCountry}`;
            
            let possibleCables = realCableRoutes[routeKey1] || realCableRoutes[routeKey2];
            
            if (!possibleCables) {
                // Generate likely cable names based on regions
                const fromRegion = countryRegions[fromCountry];
                const toRegion = countryRegions[toCountry];
                
                possibleCables = [
                    `${fromCountry}-${toCountry} Express Cable`,
                    `Trans-${fromRegion} Network`,
                    `${fromRegion}-${toRegion} Link`,
                    `Global Connect ${fromCountry}${toCountry}`
                ];
            }
            
            // Highlight cables on the map
            highlightCablesByRegion(fromCountry, toCountry);
            
            // Show results
            const fromFlag = document.querySelector(`option[value="${fromCountry}"]`).textContent;
            const toFlag = document.querySelector(`option[value="${toCountry}"]`).textContent;
            
            const resultsDiv = document.getElementById('routeResults');
            resultsDiv.innerHTML = `
                <div class="route-results">
                    <div style="font-weight: bold; color: #00d4ff; margin-bottom: 12px; text-align: center;">
                        üîç Route: ${fromFlag} ‚Üí ${toFlag}
                    </div>
                    ${possibleCables.map((cable, index) => 
                        `<div class="route-cable">
                            <div class="cable-name-small">${cable}</div>
                            <div class="cable-probability">${Math.max(90 - index * 15, 25)}%</div>
                        </div>`
                    ).join('')}
                    <div style="margin-top: 12px; font-size: 11px; color: #666; text-align: center;">
                        üí° These are the most likely cables that could carry data between these countries
                    </div>
                </div>
            `;

            showMessage(`Found ${possibleCables.length} possible cable routes between ${fromFlag.split(' ')[1]} and ${toFlag.split(' ')[1]}`, 'success');
        }
        
        // Highlight cables by region
        function highlightCablesByRegion(fromCountry, toCountry) {
            if (!map.getLayer('cables')) return;
            
            // Reset highlighting first
            clearHighlights();
            
            // Simulate highlighting by updating cable features
            setTimeout(() => {
                if (cablesData && cablesData.features) {
                    // Create a new dataset with some cables highlighted
                    const highlightedData = {
                        ...cablesData,
                        features: cablesData.features.map((feature, index) => {
                            // Highlight approximately 20% of cables to simulate possible routes
                            if (index % 5 === 0 || index % 7 === 0) {
                                return {
                                    ...feature,
                                    properties: {
                                        ...feature.properties,
                                        highlight: true
                                    }
                                };
                            }
                            return feature;
                        })
                    };
                    
                    map.getSource('cables').setData(highlightedData);
                }
            }, 500);
        }
        
        // Simulate traceroute
        function simulateTraceroute() {
            const target = document.getElementById('targetHost').value.trim();
            if (!target) {
                showError('Please enter a website or IP address to trace.');
                return;
            }
            
            const resultDiv = document.getElementById('traceResult');
            resultDiv.innerHTML = '<div class="loading">üîç Tracing network path to ' + target + '...</div>';
            
            setTimeout(() => {
                const hops = generateTracerouteHops(target);
                const simulatedTrace = `Network Path to ${target}:\n\n${hops.join('\n')}`;
                
                resultDiv.innerHTML = `<div class="trace-result">${simulatedTrace.replace(/\[SUBMARINE CABLE\]/g, '<span class="submarine-line">[SUBMARINE CABLE]</span>')}</div>`;
                
                // Highlight a cable to simulate the detected route
                highlightRandomCables(2);
                showMessage(`Network trace completed for ${target}`, 'success');
            }, 2500);
        }
        
        // Generate realistic traceroute hops
        function generateTracerouteHops(target) {
            const hops = [
                ' 1  üè† home-router.local               1.2ms',
                ' 2  üåê isp-gateway.net                12.5ms',
                ' 3  üì° local-exchange.isp.com         25.8ms',
                ' 4  üîó regional-core.isp.com          45.1ms',
                ' 5  üåä international-gateway.net       85.4ms'
            ];
            
            // Add submarine cable hops based on target
            if (target.toLowerCase().includes('google') || target.includes('8.8.8.8')) {
                hops.push(' 6  üö¢ cable-station-west.submarine.net    145.2ms  [SUBMARINE CABLE]');
                hops.push(' 7  üö¢ cable-station-east.submarine.net    185.7ms  [SUBMARINE CABLE]');
                hops.push(' 8  üîó border-router.google.com            195.3ms');
                hops.push(' 9  üéØ dns.google                          205.8ms');
            } else if (target.toLowerCase().includes('facebook') || target.toLowerCase().includes('meta')) {
                hops.push(' 6  üö¢ trans-atlantic-entry.net            125.9ms  [SUBMARINE CABLE]');
                hops.push(' 7  üö¢ trans-atlantic-exit.net             165.4ms  [SUBMARINE CABLE]');
                hops.push(' 8  üîó edge-router.facebook.com            175.1ms');
                hops.push(' 9  üéØ ' + target + '                      185.6ms');
            } else {
                hops.push(' 6  üö¢ submarine-entry.international.net   135.7ms  [SUBMARINE CABLE]');
                hops.push(' 7  üö¢ submarine-exit.destination.net      175.2ms  [SUBMARINE CABLE]');
                hops.push(' 8  üîó border-gateway.destination.com      185.9ms');
                hops.push(' 9  üéØ ' + target + '                      195.4ms');
            }
            
            return hops;
        }
        
        // Highlight random cables for demonstration
        function highlightRandomCables(count) {
            if (!map.getLayer('cables') || !cablesData) return;
            
            // Reset first
            clearHighlights();
            
            setTimeout(() => {
                const highlightedData = {
                    ...cablesData,
                    features: cablesData.features.map((feature, index) => {
                        // Highlight specific cables based on count
                        if (index % Math.floor(cablesData.features.length / count) === 0) {
                            return {
                                ...feature,
                                properties: {
                                    ...feature.properties,
                                    highlight: true
                                }
                            };
                        }
                        return feature;
                    })
                };
                
                map.getSource('cables').setData(highlightedData);
            }, 200);
        }
        
        // Show all cables
        function showAllCables() {
            if (map && map.getLayer('cables')) {
                map.setLayoutProperty('cables', 'visibility', 'visible');
                clearHighlights();
                showMessage('Displaying all submarine cables', 'info');
            }
        }
        
        // Toggle landing points visibility
        function toggleLandingPoints() {
            if (!map || !map.getLayer('landing-points')) {
                showError('Landing points data is still loading...');
                return;
            }
            
            landingPointsVisible = !landingPointsVisible;
            const visibility = landingPointsVisible ? 'visible' : 'none';
            map.setLayoutProperty('landing-points', 'visibility', visibility);
            
            const message = landingPointsVisible ? 'Landing stations are now visible' : 'Landing stations are now hidden';
            showMessage(message, 'info');
        }
        
        // Clear highlights
        function clearHighlights() {
            if (map && map.getLayer('cables') && cablesData) {
                // Reset to original data without highlights
                const originalData = {
                    ...cablesData,
                    features: cablesData.features.map(feature => {
                        const { highlight, ...props } = feature.properties;
                        return {
                            ...feature,
                            properties: props
                        };
                    })
                };
                map.getSource('cables').setData(originalData);
            }
            closeCableInfo();
            document.getElementById('routeResults').innerHTML = '';
        }

        // Reset map view
        function resetView() {
            if (map) {
                map.flyTo({
                    center: [0, 20],
                    zoom: 2.2,
                    duration: 2000
                });
                clearHighlights();
                showMessage('Map view reset to global view', 'info');
            }
        }

        // Toggle advanced features
        function toggleAdvanced() {
            const advancedSection = document.getElementById('advancedSection');
            const toggleBtn = document.querySelector('.toggle-btn');
            
            if (advancedSection.classList.contains('show')) {
                advancedSection.classList.remove('show');
                toggleBtn.textContent = '‚öôÔ∏è Show Advanced Features';
            } else {
                advancedSection.classList.add('show');
                toggleBtn.textContent = '‚öôÔ∏è Hide Advanced Features';
            }
        }
        
        // Utility functions
        function showError(message) {
            showMessage(message, 'error');
        }

        function showMessage(message, type = 'info') {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error-message, .success-message');
            existingMessages.forEach(msg => msg.remove());
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            const sidebar = document.querySelector('.sidebar');
            sidebar.insertBefore(messageDiv, sidebar.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.opacity = '0';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 500);
        }
        
        // Initialize the application when page loads
        window.addEventListener('load', function() {
            console.log('üåä Submarine Cable Tracker - Initializing...');
            setTimeout(init, 100);
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            if (map) {
                map.resize();
            }
        });
    </script>
</body>
</html>