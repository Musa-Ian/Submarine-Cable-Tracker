<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submarine Cable Tracker</title>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .sidebar {
            width: 350px;
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.3);
            overflow-y: auto;
        }
        
        .title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #00d4ff;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #cccccc;
        }
        
        input[type="text"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #2a2a3e;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            background: linear-gradient(45deg, #0099cc, #006699);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #4a4a6a, #353550);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(45deg, #353550, #2a2a3e);
        }
        
        #map {
            flex: 1;
            position: relative;
        }
        
        .info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            max-width: 300px;
            border: 1px solid #333;
            z-index: 1000;
            display: none;
        }
        
        .cable-info {
            margin-bottom: 10px;
        }
        
        .cable-name {
            font-weight: bold;
            color: #00d4ff;
            margin-bottom: 5px;
        }
        
        .cable-details {
            font-size: 12px;
            color: #cccccc;
            line-height: 1.4;
        }
        
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .status.active {
            background: #28a745;
            color: white;
        }
        
        .status.planned {
            background: #ffc107;
            color: #000;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid #333;
            z-index: 1000;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 8px;
            border-radius: 2px;
        }
        
        .trace-result {
            background: #2a2a3e;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .loading {
            color: #00d4ff;
            text-align: center;
            padding: 20px;
            animation: pulse 1.5s infinite;
        }
        
        .error-message {
            background: #dc3545;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .token-setup {
            background: #17a2b8;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            text-align: center;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="title">ðŸŒŠ Submarine Cable Tracker</div>
            
            <div class="section">
                <div class="section-title">Setup</div>
                <div class="input-group">
                    <label for="mapboxToken">Mapbox Access Token:</label>
                    <input type="text" id="mapboxToken" value="pk.eyJ1IjoiaWFubXVzYSIsImEiOiJjbWJ4aWM2cDExZDExMmpxM3RlOW9oeHY1In0.49j5NWnRfBOLdx_yhKO1YQ">
                    <button class="btn" onclick="initializeWithToken()">Initialize Map</button>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">Country Analysis</div>
                <div class="input-group">
                    <label for="fromCountry">From Country:</label>
                    <select id="fromCountry">
                        <option value="">Select country...</option>
                        <option value="US">United States</option>
                        <option value="UK">United Kingdom</option>
                        <option value="JP">Japan</option>
                        <option value="AU">Australia</option>
                        <option value="SG">Singapore</option>
                        <option value="IN">India</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="BR">Brazil</option>
                        <option value="CA">Canada</option>
                        <option value="NL">Netherlands</option>
                        <option value="ES">Spain</option>
                        <option value="IT">Italy</option>
                        <option value="SE">Sweden</option>
                        <option value="NO">Norway</option>
                        <option value="DK">Denmark</option>
                        <option value="FI">Finland</option>
                        <option value="RU">Russia</option>
                        <option value="CN">China</option>
                        <option value="KR">South Korea</option>
                        <option value="TH">Thailand</option>
                        <option value="MY">Malaysia</option>
                        <option value="ID">Indonesia</option>
                        <option value="PH">Philippines</option>
                        <option value="NZ">New Zealand</option>
                        <option value="ZA">South Africa</option>
                        <option value="EG">Egypt</option>
                        <option value="AE">UAE</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="toCountry">To Country:</label>
                    <select id="toCountry">
                        <option value="">Select country...</option>
                        <option value="US">United States</option>
                        <option value="UK">United Kingdom</option>
                        <option value="JP">Japan</option>
                        <option value="AU">Australia</option>
                        <option value="SG">Singapore</option>
                        <option value="IN">India</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="BR">Brazil</option>
                        <option value="CA">Canada</option>
                        <option value="NL">Netherlands</option>
                        <option value="ES">Spain</option>
                        <option value="IT">Italy</option>
                        <option value="SE">Sweden</option>
                        <option value="NO">Norway</option>
                        <option value="DK">Denmark</option>
                        <option value="FI">Finland</option>
                        <option value="RU">Russia</option>
                        <option value="CN">China</option>
                        <option value="KR">South Korea</option>
                        <option value="TH">Thailand</option>
                        <option value="MY">Malaysia</option>
                        <option value="ID">Indonesia</option>
                        <option value="PH">Philippines</option>
                        <option value="NZ">New Zealand</option>
                        <option value="ZA">South Africa</option>
                        <option value="EG">Egypt</option>
                        <option value="AE">UAE</option>
                    </select>
                </div>
                
                <button class="btn" onclick="findCablesBetweenCountries()">Find Possible Cables</button>
            </div>
            
            <div class="section">
                <div class="section-title">Network Trace</div>
                <div class="input-group">
                    <label for="targetHost">Target Host/IP:</label>
                    <input type="text" id="targetHost" placeholder="e.g., google.com or 8.8.8.8">
                </div>
                <button class="btn btn-secondary" onclick="simulateTraceroute()">Simulate Traceroute</button>
                <div id="traceResult"></div>
            </div>
            
            <div class="section">
                <div class="section-title">Cable Controls</div>
                <button class="btn btn-secondary" onclick="showAllCables()">Show All Cables</button>
                <button class="btn btn-secondary" onclick="toggleLandingPoints()">Toggle Landing Points</button>
                <button class="btn btn-secondary" onclick="clearHighlights()">Clear Highlights</button>
            </div>
            
            <div class="section">
                <div class="section-title">Statistics</div>
                <div style="font-size: 12px; color: #cccccc;">
                    <div>Total Cables: <span id="totalCables">Not loaded</span></div>
                    <div>Active Cables: <span id="activeCables">Not loaded</span></div>
                    <div>Landing Points: <span id="totalLandingPoints">Not loaded</span></div>
                </div>
            </div>
        </div>
        
        <div id="map">
            <div class="token-setup" id="tokenMessage">
                <h3>Setup Required</h3>
                <p>To use this submarine cable tracker, you need a free Mapbox access token:</p>
                <ol style="text-align: left; max-width: 400px; margin: 0 auto;">
                    <li>Go to <a href="https://account.mapbox.com/access-tokens/" target="_blank" style="color: #fff;">mapbox.com</a></li>
                    <li>Create a free account</li>
                    <li>Copy your default public token (starts with 'pk.')</li>
                    <li>Paste it in the sidebar and click "Initialize Map"</li>
                </ol>
            </div>
        </div>
        
        <div class="info-panel" id="infoPanel">
            <div id="panelContent"></div>
        </div>
        
        <div class="legend">
            <div style="font-weight: bold; margin-bottom: 10px; color: #00d4ff;">Legend</div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00d4ff;"></div>
                <span>Submarine Cables</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b; border-radius: 50%; height: 8px; width: 8px;"></div>
                <span>Landing Points</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffd93d;"></div>
                <span>Highlighted Route</span>
            </div>
        </div>
    </div>

    <script>
        let map = null;
        let cablesData = null;
        let landingPointsData = null;
        let landingPointsVisible = false;
        let mapInitialized = false;
        
        // Country to region mapping for cable analysis
        const countryRegions = {
            'US': 'North America', 'CA': 'North America',
            'UK': 'Europe', 'DE': 'Europe', 'FR': 'Europe', 'NL': 'Europe',
            'ES': 'Europe', 'IT': 'Europe', 'SE': 'Europe', 'NO': 'Europe',
            'DK': 'Europe', 'FI': 'Europe', 'RU': 'Europe/Asia',
            'JP': 'Asia', 'SG': 'Asia', 'IN': 'Asia', 'CN': 'Asia',
            'KR': 'Asia', 'TH': 'Asia', 'MY': 'Asia', 'ID': 'Asia', 'PH': 'Asia',
            'AU': 'Oceania', 'NZ': 'Oceania',
            'BR': 'South America',
            'ZA': 'Africa', 'EG': 'Africa',
            'AE': 'Middle East'
        };

        // Real cable data mapping (simplified)
        const realCableRoutes = {
            'US-UK': ['TAT-14', 'Hibernia Atlantic', 'Apollo North'],
            'US-JP': ['PC-1', 'TPC-5CN', 'FASTER'],
            'UK-DE': ['C-Lion1', 'TAT-14 Extension'],
            'SG-AU': ['SEA-ME-WE 3', 'Indigo-West', 'ASC'],
            'US-BR': ['Americas-II', 'BRUSA', 'Seabras-1'],
            'JP-SG': ['Asia Submarine-cable Express (ASE)', 'SJC'],
            'IN-SG': ['SEA-ME-WE 4', 'i2i'],
            'AU-NZ': ['Southern Cross Cable', 'Tasman-2'],
            'UK-NO': ['NorNed', 'North Sea Connect'],
            'US-CA': ['Hibernia Atlantic', 'Emerald Express']
        };
        
        // Initialize with Mapbox token
        function initializeWithToken() {
            let token = document.getElementById('mapboxToken').value.trim();
            
            // Try to get token from environment variable first (for production)
            if (window.MAPBOX_TOKEN) {
                token = window.MAPBOX_TOKEN;
            }
            
            if (!token) {
                alert('Please enter your Mapbox access token');
                return;
            }
            
            if (!token.startsWith('pk.')) {
                alert('Invalid token format. Mapbox public tokens start with "pk."');
                return;
            }
            
            mapboxgl.accessToken = token;
            
            // Hide token message and initialize map
            document.getElementById('tokenMessage').style.display = 'none';
            initMap();
        }
        
        // Initialize the map
        function initMap() {
            try {
                map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/dark-v11',
                    center: [0, 20],
                    zoom: 2,
                    projection: 'naturalEarth'
                });
                
                map.on('load', function() {
                    mapInitialized = true;
                    loadSubmarineCables();
                    loadLandingPoints();
                });
                
                // Add navigation controls
                map.addControl(new mapboxgl.NavigationControl());
                
                // Add click handlers for cable information
                map.on('click', 'cables', function(e) {
                    const cableInfo = e.features[0].properties;
                    showCableInfo(cableInfo);
                });
                
                map.on('mouseenter', 'cables', function() {
                    map.getCanvas().style.cursor = 'pointer';
                });
                
                map.on('mouseleave', 'cables', function() {
                    map.getCanvas().style.cursor = '';
                });
                
            } catch (error) {
                console.error('Error initializing map:', error);
                showError('Failed to initialize map. Please check your Mapbox token.');
            }
        }
        
        // Load submarine cables data
        async function loadSubmarineCables() {
            try {
                showStatus('Loading submarine cables...');
                
                const response = await fetch('https://www.submarinecablemap.com/api/v3/cable/cable-geo.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                cablesData = data;
                
                map.addSource('cables', {
                    'type': 'geojson',
                    'data': data
                });
                
                map.addLayer({
                    'id': 'cables',
                    'type': 'line',
                    'source': 'cables',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#00d4ff',
                        'line-width': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            2, 1,
                            10, 3
                        ],
                        'line-opacity': 0.8
                    }
                });
                
                // Update statistics
                document.getElementById('totalCables').textContent = data.features.length;
                const activeCables = data.features.filter(f => f.properties.rfs !== null).length;
                document.getElementById('activeCables').textContent = activeCables;
                
                console.log(`Loaded ${data.features.length} submarine cables`);
                
            } catch (error) {
                console.error('Error loading submarine cables:', error);
                showError('Failed to load submarine cable data. This might be due to CORS restrictions or network issues.');
                
                // Fallback: Create some sample cable data for demonstration
                createSampleCableData();
            }
        }
        
        // Create sample cable data if real data fails to load
        function createSampleCableData() {
            const sampleCables = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "Sample Transatlantic Cable",
                            "id": "sample-1",
                            "color": "#00d4ff"
                        },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [[-74, 40], [-0.1, 51.5]]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "Sample Transpacific Cable",
                            "id": "sample-2",
                            "color": "#00d4ff"
                        },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [[-122, 37], [139, 35]]
                        }
                    }
                ]
            };
            
            cablesData = sampleCables;
            
            map.addSource('cables', {
                'type': 'geojson',
                'data': sampleCables
            });
            
            map.addLayer({
                'id': 'cables',
                'type': 'line',
                'source': 'cables',
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#00d4ff',
                    'line-width': 2,
                    'line-opacity': 0.8
                }
            });
            
            document.getElementById('totalCables').textContent = '2 (Sample)';
            document.getElementById('activeCables').textContent = '2 (Sample)';
            
            showError('Using sample cable data. Real data failed to load.');
        }
        
        // Load landing points data
        async function loadLandingPoints() {
            try {
                const response = await fetch('https://www.submarinecablemap.com/api/v3/landing-point/landing-point-geo.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                landingPointsData = data;
                
                map.addSource('landing-points', {
                    'type': 'geojson',
                    'data': data
                });
                
                map.addLayer({
                    'id': 'landing-points',
                    'type': 'circle',
                    'source': 'landing-points',
                    'layout': {
                        'visibility': 'none'
                    },
                    'paint': {
                        'circle-radius': [
                            'interpolate',
                            ['linear'],
                            ['zoom'],
                            2, 2,
                            10, 6
                        ],
                        'circle-color': '#ff6b6b',
                        'circle-opacity': 0.8,
                        'circle-stroke-color': '#ffffff',
                        'circle-stroke-width': 1
                    }
                });
                
                // Update statistics
                document.getElementById('totalLandingPoints').textContent = data.features.length;
                console.log(`Loaded ${data.features.length} landing points`);
                
            } catch (error) {
                console.error('Error loading landing points:', error);
                document.getElementById('totalLandingPoints').textContent = 'Failed to load';
            }
        }
        
        // Show cable information
        function showCableInfo(cableInfo) {
            const panel = document.getElementById('infoPanel');
            const content = document.getElementById('panelContent');
            
            content.innerHTML = `
                <div class="cable-info">
                    <div class="cable-name">${cableInfo.name || 'Unknown Cable'}</div>
                    <div class="cable-details">
                        ID: ${cableInfo.id || 'N/A'}<br>
                        ${cableInfo.rfs ? `Ready for Service: ${cableInfo.rfs}<br>` : ''}
                        ${cableInfo.length ? `Length: ${cableInfo.length} km<br>` : ''}
                        ${cableInfo.owners ? `Owners: ${cableInfo.owners}<br>` : ''}
                        Color: <span style="color: ${cableInfo.color || '#00d4ff'}">${cableInfo.color || '#00d4ff'}</span>
                    </div>
                    <div class="status active">Active</div>
                </div>
            `;
            
            panel.style.display = 'block';
        }
        
        // Find cables between countries
        function findCablesBetweenCountries() {
            const fromCountry = document.getElementById('fromCountry').value;
            const toCountry = document.getElementById('toCountry').value;
            
            if (!fromCountry || !toCountry) {
                alert('Please select both countries');
                return;
            }
            
            if (!mapInitialized) {
                alert('Please initialize the map first');
                return;
            }
            
            // Look for real cable routes
            const routeKey1 = `${fromCountry}-${toCountry}`;
            const routeKey2 = `${toCountry}-${fromCountry}`;
            
            let possibleCables = realCableRoutes[routeKey1] || realCableRoutes[routeKey2];
            
            if (!possibleCables) {
                // Generate likely cable names based on regions
                const fromRegion = countryRegions[fromCountry];
                const toRegion = countryRegions[toCountry];
                
                possibleCables = [
                    `${fromCountry}-${toCountry} Express`,
                    `Trans-${fromRegion}-${toRegion}`,
                    `${fromRegion} Connect`,
                    `Global Link ${fromCountry}${toCountry}`
                ];
            }
            
            // Highlight cables on the map
            highlightCablesByRegion(fromCountry, toCountry);
            
            // Show results
            showCableInfo({
                name: `Route Analysis: ${fromCountry} â†’ ${toCountry}`,
                id: 'route-analysis',
                color: '#ffd93d'
            });
            
            document.getElementById('panelContent').innerHTML += `
                <div style="margin-top: 15px;">
                    <div style="font-weight: bold; color: #ffd93d; margin-bottom: 10px;">Possible Cables:</div>
                    ${possibleCables.map((cable, index) => 
                        `<div style="margin-bottom: 8px; font-size: 12px;">
                            <div style="color: #00d4ff;">${cable}</div>
                            <div style="color: #cccccc;">Probability: ${85 - index * 15}%</div>
                        </div>`
                    ).join('')}
                </div>
            `;
        }
        
        // Highlight cables by region
        function highlightCablesByRegion(fromCountry, toCountry) {
            if (!map.getLayer('cables')) return;
            
            // Reset highlighting
            map.setPaintProperty('cables', 'line-color', '#00d4ff');
            
            // Simulate highlighting by randomly selecting some cables
            setTimeout(() => {
                map.setPaintProperty('cables', 'line-color', [
                    'case',
                    ['<', ['random'], 0.2], // Highlight ~20% of cables
                    '#ffd93d',
                    '#00d4ff'
                ]);
            }, 500);
        }
        
        // Simulate traceroute
        function simulateTraceroute() {
            const target = document.getElementById('targetHost').value.trim();
            if (!target) {
                alert('Please enter a target host or IP');
                return;
            }
            
            const resultDiv = document.getElementById('traceResult');
            resultDiv.innerHTML = '<div class="loading">Tracing route to ' + target + '...</div>';
            
            setTimeout(() => {
                const hops = generateTracerouteHops(target);
                const simulatedTrace = `traceroute to ${target}:\n${hops.join('\n')}`;
                
                resultDiv.innerHTML = `<div class="trace-result">${simulatedTrace}</div>`;
                
                // Highlight a cable to simulate the detected route
                highlightRandomCables(1);
            }, 2000);
        }
        
        // Generate realistic traceroute hops
        function generateTracerouteHops(target) {
            const hops = [
                ' 1  192.168.1.1  1.234 ms',
                ' 2  10.0.0.1  15.456 ms',
                ' 3  isp-gateway.local  25.789 ms',
                ' 4  edge-router.isp.com  45.123 ms',
                ' 5  core-router.isp.com  85.456 ms'
            ];
            
            // Add submarine cable hops based on target
            if (target.includes('google') || target.includes('8.8.8.8')) {
                hops.push(' 6  submarine-cable-entry.level3.net  125.789 ms');
                hops.push(' 7  cable-station-a.submarine.net  165.123 ms  [SUBMARINE CABLE]');
                hops.push(' 8  cable-station-b.submarine.net  185.456 ms  [SUBMARINE CABLE]');
                hops.push(' 9  submarine-cable-exit.google.com  195.789 ms');
                hops.push('10  dns.google  205.123 ms');
            } else {
                hops.push(' 6  international-gateway.isp.com  95.789 ms');
                hops.push(' 7  submarine-cable.international.net  145.123 ms  [SUBMARINE CABLE]');
                hops.push(' 8  dest-cable-station.net  185.456 ms  [SUBMARINE CABLE]');
                hops.push(' 9  border-router.destination.net  195.789 ms');
                hops.push(`10  ${target}  215.456 ms`);
            }
            
            return hops;
        }
        
        // Highlight random cables for demonstration
        function highlightRandomCables(count) {
            if (!map.getLayer('cables')) return;
            
            // Reset all cables to default color
            map.setPaintProperty('cables', 'line-color', '#00d4ff');
            
            // Highlight some cables
            setTimeout(() => {
                map.setPaintProperty('cables', 'line-color', [
                    'case',
                    ['<', ['random'], 0.1], // Highlight ~10% of cables
                    '#ffd93d',
                    '#00d4ff'
                ]);
            }, 200);
        }
        
        // Show all cables
        function showAllCables() {
            if (map && map.getLayer('cables')) {
                map.setLayoutProperty('cables', 'visibility', 'visible');
                map.setPaintProperty('cables', 'line-color', '#00d4ff');
            }
            document.getElementById('infoPanel').style.display = 'none';
        }
        
        // Toggle landing points visibility
        function toggleLandingPoints() {
            if (!map || !map.getLayer('landing-points')) return;
            
            landingPointsVisible = !landingPointsVisible;
            const visibility = landingPointsVisible ? 'visible' : 'none';
            map.setLayoutProperty('landing-points', 'visibility', visibility);
        }
        
        // Clear highlights
        function clearHighlights() {
            if (map && map.getLayer('cables')) {
                map.setPaintProperty('cables', 'line-color', '#00d4ff');
            }
            document.getElementById('infoPanel').style.display = 'none';
        }
        
        // Utility functions
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.sidebar').appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
        
        function showStatus(message) {
            console.log(message);
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            console.log('Submarine Cable Tracker loaded. Auto-initializing with provided token...');
            // Auto-initialize with the provided token
            setTimeout(initializeWithToken, 1000);
        });
    </script>
</body>
</html>